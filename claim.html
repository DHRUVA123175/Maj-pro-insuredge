<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>File Vehicle Claim | InsurEdge AI</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    body {
      background: linear-gradient(180deg, orange, white, green);
    }

    .claim-container {
      max-width: 600px;

      margin: 50px auto;
      background: linear-gradient(45deg, lightcoral, lightblue, peachpuff);
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);

    }

    .claim-container h2 {
      text-align: center;
      margin-bottom: 24px;
      font-weight: 600;
      color: black;

    }

    .claim-container label {
      display: block;
      margin-bottom: 8px;
      font-weight: 800;
      color: #444;
    }

    .claim-container input,
    .claim-container textarea,
    .claim-container select {
      width: 100%;
      padding: 12px;
      margin-bottom: 20px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1rem;
    }

    .claim-container input[type="file"] {
      border: none;
    }

    .claim-container input:focus,
    .claim-container textarea:focus,
    .claim-container select:focus {
      outline: none;
      border-color: #6a11cb;
      box-shadow: 0 0 5px rgba(106, 17, 203, 0.4);
    }

    .evi {
      font-weight: 800;
      color: palevioletred;
    }

    .submit-btn {
      width: 100%;
      background: linear-gradient(90deg, #f0c14b, #ffa41c);
      border: none;
      padding: 12px;
      font-size: 1rem;
      font-weight: bold;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .submit-btn:hover {
      background: linear-gradient(90deg, #ffa41c, #f0c14b);
    }

    .ai-note {
      background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      border-left: 4px solid #6a11cb;
    }

    .ai-note h4 {
      color: #6a11cb;
      margin-bottom: 8px;
      font-weight: 600;
    }

    .ai-note p {
      color: #444;
      font-size: 0.9rem;
      margin: 0;
    }
  </style>
</head>

<body>
  <!-- Navbar -->
  <header class="navbar">
    <div class="navbar-logo">InsurEdge AI</div>
    <nav>
      <ul class="navbar-menu">
        <li><a href="index.html">Home</a></li>
        <li><a href="dashboard.html">Dashboard</a></li>
        <li><a href="login.html">Logout</a></li>
      </ul>
    </nav>
  </header>

  <!-- Claim Form -->
  <div class="claim-container">
    <h2>File a Vehicle Insurance Claim</h2>

    <div class="ai-note">
      <h4>ü§ñ AI-Powered Damage Detection</h4>
      <p>Upload clear photos of your vehicle damage. Our AI will analyze the images to assess damage severity and
        expedite your claim processing.</p>
    </div>

    <form action="#" method="POST" enctype="multipart/form-data">
      <label for="policy-id">Vehicle Policy ID</label>
      <input type="text" id="policy-id" name="policy_id" placeholder="Enter your vehicle policy number" required />

      <label for="vehicle-info">Vehicle Information</label>
      <input type="text" id="vehicle-info" name="vehicle_info" placeholder="Make, Model, Year (e.g., Honda Civic 2020)"
        required />

      <label for="claim-type">Damage Type</label>
      <select id="claim-type" name="claim_type" required>
        <option value="">Select Damage Type</option>
        <option value="collision">Vehicle Collision</option>
        <option value="theft">Vehicle Theft</option>
        <option value="vandalism">Vandalism</option>
        <option value="fire">Fire Damage</option>
        <option value="flood">Flood/Water Damage</option>
        <option value="hail">Hail Damage</option>
        <option value="other">Other</option>
      </select>

      <label for="description">Incident Description</label>
      <textarea id="description" name="description" rows="5" placeholder="Describe what happened to your vehicle..."
        required></textarea>

      <label for="evidence" class="evi">Upload Vehicle Damage Photos</label>
      <input type="file" id="evidence" name="evidence" accept="image/*" multiple required />
      <small style="color: #666; font-size: 0.85rem;">Upload multiple photos showing different angles of the damage for
        better AI analysis</small>

      <button type="submit" class="submit-btn">Process Claim with AI</button>
    </form>
  </div>
  <script>
    const form = document.querySelector("form");
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const token = localStorage.getItem("token");
      if (!token) {
        alert("Please login first");
        window.location.href = "login.html";
        return;
      }

      // Show loading state
      const submitBtn = document.querySelector(".submit-btn");
      const originalText = submitBtn.textContent;
      submitBtn.textContent = "ü§ñ AI Processing...";
      submitBtn.disabled = true;

      const formData = new FormData(form);

      try {
        const res = await fetch("http://localhost:8000/api/claims", {
          method: "POST",
          headers: {
            'Authorization': `Bearer ${token}`
          },
          body: formData,
        });

        if (!res.ok) {
          const errorData = await res.json();
          throw new Error(errorData.error || "Failed to submit vehicle claim");
        }

        const data = await res.json();
        showResults(data);
        form.reset();

      } catch (err) {
        alert("Error: " + err.message);
      } finally {
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
      }
    });

    function showResults(data) {
      const ai = data.ai_assessment;
      const fraud = ai.fraud_analysis || {};

      // Determine status color and text based on claim status
      let statusColor, statusText, statusIcon;

      if (ai.claim_status === 'rejected') {
        statusColor = '#dc3545';
        statusText = 'üö® REJECTED';
        statusIcon = '‚ùå';
      } else if (ai.claim_status === 'under_review') {
        statusColor = '#ffc107';
        statusText = '‚ö†Ô∏è UNDER REVIEW';
        statusIcon = 'üîç';
      } else {
        statusColor = '#28a745';
        statusText = '‚úÖ APPROVED';
        statusIcon = '‚úÖ';
      }

      const resultsHTML = `
            <div style="background: linear-gradient(135deg, #e3f2fd, #f3e5f5); padding: 20px; border-radius: 12px; margin: 20px 0; border-left: 4px solid #6a11cb;">
              <h3 style="color: #6a11cb; margin-bottom: 15px;">ü§ñ AI Analysis Complete!</h3>
              
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                <div style="background: white; padding: 15px; border-radius: 8px;">
                  <strong>Claim ID:</strong><br>
                  <span style="color: #6a11cb; font-size: 1.1em;">${data.claim_id}</span>
                </div>
                <div style="background: white; padding: 15px; border-radius: 8px;">
                  <strong>Status:</strong><br>
                  <span style="color: ${statusColor}; font-weight: bold;">${statusText}</span>
                </div>
              </div>

              <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
                  <strong>Damage Type</strong><br>
                  <span style="color: #333; font-size: 1.1em;">${ai.damage_type?.toUpperCase() || 'UNKNOWN'}</span>
                </div>
                <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
                  <strong>Severity</strong><br>
                  <span style="color: #333; font-size: 1.1em;">${ai.damage_severity?.toUpperCase() || 'UNKNOWN'}</span>
                </div>
                <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
                  <strong>Confidence</strong><br>
                  <span style="color: #51cf66; font-size: 1.1em; font-weight: bold;">${ai.confidence_score || 0}%</span>
                </div>
              </div>

              <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                <strong>üí∞ Estimated Repair Cost:</strong><br>
                <span style="color: #6a11cb; font-size: 1.3em; font-weight: bold;">‚Çπ${(ai.estimated_cost || 0).toLocaleString()}</span>
              </div>

              ${fraud.fraud_detected ? `
                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border-left: 4px solid #ffc107; margin-bottom: 15px;">
                  <strong>‚ö†Ô∏è Fraud Alert:</strong><br>
                  <span style="color: #856404;">Risk Level: ${fraud.risk_level}</span><br>
                  <small>Additional verification required</small>
                </div>
              ` : ''}

              ${ai.recommendations && ai.recommendations.length > 0 ? `
                <div style="background: white; padding: 15px; border-radius: 8px;">
                  <strong>üí° Recommendations:</strong>
                  <ul style="margin: 10px 0; padding-left: 20px;">
                    ${ai.recommendations.map(rec => `<li style="margin: 5px 0;">${rec}</li>`).join('')}
                  </ul>
                </div>
              ` : ''}

              <div style="text-align: center; margin-top: 20px;">
                <button onclick="window.location.href='dashboard.html'" style="background: linear-gradient(90deg, #6a11cb, #2575fc); color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-weight: bold;">
                  View Dashboard ‚Üí
                </button>
              </div>
            </div>
          `;

      // Insert results after the form
      const container = document.querySelector('.claim-container');
      const existingResults = container.querySelector('.ai-results');
      if (existingResults) {
        existingResults.remove();
      }

      const resultsDiv = document.createElement('div');
      resultsDiv.className = 'ai-results';
      resultsDiv.innerHTML = resultsHTML;
      container.appendChild(resultsDiv);

      // Scroll to results
      resultsDiv.scrollIntoView({ behavior: 'smooth' });
    }
  </script>

</body>

</html>